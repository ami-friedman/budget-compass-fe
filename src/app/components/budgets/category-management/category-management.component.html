<div class="container mx-auto p-4">
  <h2 class="text-2xl font-bold mb-6">Manage Categories</h2>

  <!-- Side by Side Layout -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Add New Category Form -->
    <div>
      <p-card header="Add New Category">
        <div class="flex items-center gap-2">
          <input
            pInputText
            type="text"
            [(ngModel)]="newCategoryName"
            (keyup.enter)="addCategory()"
            placeholder="e.g., Groceries"
            class="flex-1 text-gray-900 bg-white"
          />
          <p-button (click)="addCategory()" label="Add" icon="pi pi-plus"></p-button>
        </div>
      </p-card>
    </div>

    <!-- Categories Dropdown -->
    <div>
      <p-card header="Categories">
        <p-select
          [(ngModel)]="selectedCategory"
          [options]="categories()"
          optionLabel="name"
          placeholder="Select a category to manage"
          [filter]="true"
          filterPlaceholder="Search categories..."
          [showClear]="true"
          styleClass="w-full">
          
          <!-- Custom item template with edit/archive buttons -->
          <ng-template pTemplate="item" let-category>
            <div class="flex items-center justify-between w-full">
              @if (editingCategoryId === category.id) {
                <input
                  pInputText
                  type="text"
                  [(ngModel)]="editingCategoryName"
                  (keyup.enter)="saveCategory(category.id)"
                  (keyup.escape)="cancelEdit()"
                  (click)="$event.stopPropagation()"
                  class="flex-1 text-gray-900 bg-white"
                  autofocus
                />
                <div class="flex gap-1 ml-2" (click)="$event.stopPropagation()">
                  <p-button
                    (click)="saveCategory(category.id)"
                    icon="pi pi-check"
                    [outlined]="true"
                    [rounded]="true"
                    severity="success"
                    size="small"
                    pTooltip="Save"
                    tooltipPosition="top">
                  </p-button>
                  <p-button
                    (click)="cancelEdit()"
                    icon="pi pi-times"
                    [outlined]="true"
                    [rounded]="true"
                    severity="secondary"
                    size="small"
                    pTooltip="Cancel"
                    tooltipPosition="top">
                  </p-button>
                </div>
              } @else {
                <span class="flex-1">{{ category.name }}</span>
                <div class="flex gap-1" (click)="$event.stopPropagation()">
                  <p-button
                    (click)="startEdit(category); $event.stopPropagation()"
                    icon="pi pi-pencil"
                    [outlined]="true"
                    [rounded]="true"
                    severity="secondary"
                    size="small"
                    pTooltip="Edit"
                    tooltipPosition="top">
                  </p-button>
                  <p-button
                    (click)="archiveCategory(category.id); $event.stopPropagation()"
                    icon="pi pi-trash"
                    [outlined]="true"
                    [rounded]="true"
                    severity="danger"
                    size="small"
                    pTooltip="Archive"
                    tooltipPosition="top">
                  </p-button>
                </div>
              }
            </div>
          </ng-template>
        </p-select>
      </p-card>
    </div>
  </div>
</div>