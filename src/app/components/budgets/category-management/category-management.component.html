<div class="container mx-auto p-4">
  <h2 class="text-2xl font-bold mb-6">Manage Categories</h2>

  <!-- Side by Side Layout -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
    <!-- Add New Category Form -->
    <div>
      <p-card header="Add New Category">
        <div class="flex items-center gap-2">
          <input
            pInputText
            type="text"
            [(ngModel)]="newCategoryName"
            (keyup.enter)="addCategory()"
            placeholder="e.g., Groceries"
            class="flex-1 text-gray-900 bg-white"
          />
          <p-button (click)="addCategory()" label="Add" icon="pi pi-plus"></p-button>
        </div>
      </p-card>
    </div>

    <!-- Categories Dropdown -->
    <div class="dropdown-container">
      <p-card header="Categories">
        <!-- Dropdown Toggle Button -->
        <div class="mb-4">
          <p-button
            (click)="toggleDropdown()"
            [label]="selectedCategory ? selectedCategory.name : 'Select a category to manage'"
            icon="pi pi-chevron-down"
            styleClass="w-full justify-between p-button-outlined"
            [iconPos]="'right'"
          ></p-button>
        </div>

        <!-- Dropdown Content -->
        @if (showDropdown) {
          <div class="border rounded-lg shadow-lg bg-white max-h-96 overflow-y-auto relative z-10">
            <!-- Search Input -->
            <div class="p-3 border-b">
              <input
                pInputText
                type="text"
                [(ngModel)]="searchValue"
                placeholder="Search categories..."
                class="w-full text-gray-900 bg-white"
              />
            </div>

            <!-- Categories List -->
            <div class="max-h-64 overflow-y-auto">
              @for (category of categories(); track category.id) {
                @if (!searchValue || category.name.toLowerCase().includes(searchValue.toLowerCase())) {
                  <div class="flex items-center justify-between p-3 border-b hover:bg-gray-50">
                    <div class="flex-1 cursor-pointer" (click)="selectCategory(category)">
                      @if (editingCategoryId === category.id) {
                        <input
                          pInputText
                          type="text"
                          [(ngModel)]="editingCategoryName"
                          (keyup.enter)="saveCategory(category.id)"
                          (keyup.escape)="cancelEdit()"
                          (click)="$event.stopPropagation()"
                          class="w-full text-gray-900 bg-white"
                          autofocus
                        />
                      } @else {
                        <span class="text-lg text-gray-900">{{ category.name }}</span>
                      }
                    </div>
                    <div class="flex items-center gap-2 ml-4" (click)="$event.stopPropagation()">
                      @if (editingCategoryId === category.id) {
                        <p-button
                          (click)="saveCategory(category.id)"
                          icon="pi pi-check"
                          label="Save"
                          styleClass="p-button-sm p-button-success"
                        ></p-button>
                        <p-button
                          (click)="cancelEdit()"
                          icon="pi pi-times"
                          label="Cancel"
                          styleClass="p-button-sm p-button-secondary"
                        ></p-button>
                      } @else {
                        <p-button
                          (click)="startEdit(category)"
                          icon="pi pi-pencil"
                          label="Edit"
                          styleClass="p-button-sm p-button-outlined"
                        ></p-button>
                        <p-button
                          (click)="archiveCategory(category.id)"
                          icon="pi pi-archive"
                          label="Archive"
                          styleClass="p-button-sm p-button-danger p-button-outlined"
                        ></p-button>
                      }
                    </div>
                  </div>
                }
              } @empty {
                <div class="text-center py-8 text-gray-500">
                  <svg class="w-12 h-12 mx-auto mb-2 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2.586a1 1 0 00-.707.293l-2.414 2.414a1 1 0 01-.707.293h-3.172a1 1 0 01-.707-.293l-2.414-2.414A1 1 0 006.586 13H4"></path>
                  </svg>
                  <p>No categories found. Add one to get started!</p>
                </div>
              }
            </div>

            <!-- Clear Selection Button -->
            @if (selectedCategory) {
              <div class="p-3 border-t">
                <p-button
                  (click)="clearSelection()"
                  label="Clear Selection"
                  icon="pi pi-times"
                  styleClass="w-full p-button-outlined p-button-secondary"
                ></p-button>
              </div>
            }
          </div>
        }
      </p-card>
    </div>
  </div>
</div>